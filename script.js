document.addEventListener("DOMContentLoaded",function(){function e(e,t,n){var i=document.createElement(t);return i.className=n,e&&e.append(i),i}function t(e,t){return function(e,t,n,i,a){return(e-parseFloat(t))/(parseFloat(n)-parseFloat(t))*(parseFloat(a)-parseFloat(i))+parseFloat(i)}(Math.random(),0,1,e,t)}function n(e){var t=0;for(var n of e)t+=parseFloat(n[0]);var i=Math.random()*t;for(var n of(t=0,e))if(i<(t+=parseFloat(n[0])))return n[1];return e[0][1]}function i(e,t,n){var i=n;".val-count"===e&&document.querySelector(".val-type").addEventListener("change",function(){i=d(),document.querySelector(".val-count").value=Math.min(document.querySelector(".val-count").value,i)}),document.querySelectorAll(e).forEach(function(e){e.addEventListener("focusout",function(){this.value=M(this.value,t,i)})})}function a(e){var t=e/2.54;return Math.floor(t/12)+"ft "+(t=Math.round(t%12))+"in"}function r(e,t){var n=Math.random()*e,i=Math.abs(t-n)/(e/100),a=Math.pow(.9,i),r=0;for(;Math.random()>a&&((n=Math.random()*e)>e&&(n=t),i=Math.abs(t-n)/(e/100),a=Math.pow(.9,i),!(++r>=1e4)););return r<1e4?n:t}function o(e,t){var n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}function s(e,t,n,i=1){var a=Math.random()*Math.PI*2,r=Math.pow(Math.random(),i),o=n*r+t*(1-r);return{x:Math.sin(a)*o+e.x,y:Math.cos(a)*o+e.y}}var l,c=new Q;function d(){return{Worker:150,Seedling:225,Soldier:45,Drone:30,Queen:1,Hive:451}[document.querySelector(".val-type").value]||-1}var h={name:"None"};function u(e){return(e=e.replace(/;/g,"\n").replace(/:/g,",")).split("\n").map(function(e){var t={name:(e=e.split(","))[0].trim()};"wsamfptlcveih".split("").forEach(function(e){t[e+"Mult"]=1});for(var n=1;n<e.length;n++){var i=(""+e[n]).trim(),a=i[0],r=i.substr(1);t[a+"Mult"]=parseFloat(r)}return t})}function m(e,t,n){var i=(t=(Array.isArray(t)?t:[t]).map(e=>e.name)).concat(...n.filter(e=>e.find(e=>t.includes(e))));return e.filter(e=>!i.find(t=>t==e.name))}"wsamfptlcveih".split("").forEach(function(e){h[e+"Mult"]=1}),i(".val-mutation",0,100),i(".val-luminous",0,25),i(".val-count",1,d()),i(".val-multitrait",-20,60),document.querySelectorAll(".val-mutation, .val-luminous, .val-multitrait, .val-count").forEach(function(e){var t=/^(-?0|-?[1-9]\d*|\b)$|^$/;e.addEventListener("input",function(e){var n=e.target,i=n.value;t.test(i)||(n.value=n.value.slice(0,-1))}),e.addEventListener("paste",function(e){var n=e.clipboardData.getData("text");t.test(n)||e.preventDefault()})}),document.querySelectorAll(".tabs").forEach(function(e){var t=[];function n(e){t.forEach(function(t,n){t.element.classList.toggle("tab-active",e==n),t.target.style.display=e==n?"":"none"})}e.querySelectorAll(".tab").forEach(function(e,i){t.push({element:e,target:document.querySelector(e.getAttribute("data-sel"))}),e.addEventListener("click",function(){n(i)})}),n(0)});var f="Big Boned:Lithe\nButterface:Handsome\nEvil:Good\nFussy Eater:Regular\nGenetic Mutation:Good Breeding\nGenius:Nice but Dim\nGiver:Taker\nImmune:Sickly\nInsane:Joyful\nLimited Efficiency:Robust\nLoyal:Surly\nOld at Heart:Young at Heart\nPlain:Handsome\nProducer:Stingy\nSickly:Immune\nSlowpoke:Hyperactive\nSmelly:Sparkling\nStingy:Producer\nStudly:Butterface\nSullen:Jovial\nSurly:Loyal\nVirile:Sickly\nWhimsical:Enigmatic\nConstipated:Regular\nGenetic Inferiority:Golden Gift\nGenetic Instability:Good Breeding\nGlistening:Smelly\nGolden Gift:Genetic Inferiority\nGood Breeding:Genetic Instability\nMysterious:Enigmatic\nPerfected:Nice but Dim\nPrize Specimen:Freak of Nature\nRadiant:Smelly\nStressed:Regular\nStrong Genes:Genetic Inferiority\nUnlucky for Some:Lucky".split("\n").map(e=>e.split(":"));const p=[];p.push(u("Missing patches of skin;Parasites:f0.8;Brown lumps on body;Wrinkly skin;Severe scarring\nMissing vines:p0.8;Leaking resin:p0.8;Open wounds;Fungal growths;Missing teeth,l0.8;Extra eye\nExtra arm;Extra leg;Assymetry;Malignant atavism")),p.push(u("Minor wounds;Discoloration;Missing tailtip:t0.9,l0.9;Overbite:i0.9;Damaged vines:p0.9,t0.9\nExtra vines:p0.9,t0.9;Extra finger:i0.9;Extra toe:i0.9;Crooked teeth:i0.9;Mites\nExcessive salivation;Longer tongue:i0.9;Shorter tail:t0.9,l0.9;Shorter limbs:t0.9,l0.9;Straighter posture:l0.9,t1.1")),p.push(u("Minor scarring;Dappling on face;Dappling around shoulders;Larger claws;Small horns\nDappling around hips;Neoteny;Quadruped posture;Dappling on thighs;Dewclaws on feet")),p.push(u("Leaves on vines:v1.1,e1.1;Leaves on tail:v1.1,e1.1;Glossy skin;Bright eyes;Toned:c1.1,w1.1\nThicker thighs:s1.1,v1.1;Longer tail;Stronger teeth;Vibrant coloration")),p.push(u("Iridescent skin;Colorful frills;Vivid coloration;Big head frill:p1.2,a1.1,e1.1;Thicker arms:c1.3\nWing-like vine frills;Crown-like headcrest:e1.1;Leaf cape:e1.2;Honey golden eyes;Bioluminescent spots\nFeathered leaf margins;Benign atavism"));var g=u("Anxiety:e0.8,i0.9,h0.7;Limp:s0.8,t0.9,l1.1;ADHD:v0.9,e0.8,i0.7;Cataracts:i0.8\nPresbycusis:i0.8,e0.7;Dyspraxia:v0.9,e0.8,i0.7;Bradyphrenia:i0.8,e0.7\nMuscular Dystrophy:c0.9,s0.8,t0.9;Primary Immune Deficiency:h0.8\nShort Term Memory Loss:i0.9,e0.8;Long Term Memory Loss:i0.8,e0.8;Epilepsy:i0.9,e0.8,h0.7\nBlindness:i0.8;Deafness:i0.8;Arthritis:c0.9,s0.8,t0.9;Depression:e0.8,i0.9,h0.7;Parkinson's Syndrome:v0.9,e0.8,h0.8"),y=u("Big Boned:w1.1,l1.2,c1.3;Butterface:w1.1,s1.1,a0.9;Chatty:e1.1\nCurvy:w1.1,s0.9,a1.1;Enigmatic:i1.1;Evil:e0.9\nFearless:c1.2;Fussy Eater:w0.9,f0.9;Genetic Mutation:i1.2\nGenius:i1.5;Giver:f1.1;Good\nHandsome:a1.1;Hyperactive:s1.1,v1.2;Immune:h1.3\nInsane:i0.9;Jovial:e1.2;Joyful\nLimited Efficiency:c0.9;Lithe:w0.9,s1.1,a1.1,l1.1,v1.2;Lucky:f1.2\nLoyal;Nightmare:a0.8,i0.8;Old at Heart:m1.1\nPlain:a0.9;Producer:p1.3;Robust:h1.2\nSickly:h0.9;Slowpoke:s0.9,v0.9;Smelly:a0.9\nSparkling;Stingy:f0.9;Studly:t1.3,l1.3,c1.4\nSullen:e0.8;Surly:i0.8;Taker:f0.8\nVirile:f1.3,p1.3;Whimsical:i1.2;Young at Heart:m0.9"),v=[];v.push(y.concat(u("Constipated:h0.8;Genetic Inferiority:i0.8,h0.8;Regular;Stressed:h0.9"))),v.push(y.concat(u("Charmed;Genetic Inferiority:i0.8,h0.8;Genetic Instability:i0.9\nGlistening;Golden Gift;Good Breeding:h1.3\nMysterious:f1.2,i1.1;Perfected:w1.1,s1.1,a1.1,m1.1,f1.1,p1.1,t1.1,l1.1,c1.1,v1.1,e1.1,i1.1,h1.1;Ravensworn:m1.1,e1.2,h1.1\nStressed:h0.9;Strong Genes:i1.2;Unlucky for Some:f0.9,p0.9,h0.9"))),v.push(y.concat(u("Charmed;Exalted:i1.1;Fortunate:l1.1,c1.1\nFreak of Nature:l1.2,c1.2,e1.2;Genetic Instability:f0.8,p0.8,t0.8,l0.8,c0.8,e0.9,i0.9,h0.9;Glistening:t1.1,l1.1,c1.1,e1.1,i1.1,h1.1\nGolden Gift;Good Breeding;Mysterious:f1.2,i1.1\nNice but Dim:i0.9;Perfected;Prize Specimen:w1.2,s1.2,a1.2,m1.2,f1.2,p1.2,t1.2,l1.2,c1.2,v1.2,e1.2,i1.2,h1.2\nRadiant:f1.1;Ravensworn:m1.1,e1.2;Unlucky for Some:f0.9,p0.9,h0,9"))),y.find(e=>"Butterface"==e.name).aLimitHigh=1200,y.find(e=>"Handsome"==e.name).aLimitLow=1200,y.find(e=>"Nightmare"==e.name).aLimitHigh=800,y.find(e=>"Plain"==e.name).aLimitHigh=1200,y.find(e=>"Plain"==e.name).aLimitLow=800,y.find(e=>"Immune"==e.name).hLimitLow=100;var w="20:Weight loss\n30:Vomiting\n40:Coughing\n50:Sneezing\n60:Runny nose\n70:Eye/ear discharge\n40:Skin infection\n50:Swelling\n30:Anemia\n40:Abscesses\n60:Discharge from orifices".split("\n").map(e=>e.split(":")),x="2100:Perfect\n2000:Divine\n1900:Stunning\n1700:Gorgeous\n1500:Beautiful\n1300:Good Looking\n1100:Attractive\n900:Average\n700:Ordinary\n500:Below Average\n300:Unattractive\n100:Ugly\n0:Hideous".split("\n").map(e=>e.split(":"));function b(e){return e[parseInt(Math.random()*e.length)]||h}function S(e,t){var n=t[Math.floor(M(e.attractiveness,0,1999)/400)],i=10+.05*Math.abs(1e3-e.attractiveness);return(Math.random()<i/100?n[Math.floor(Math.random()*n.length)]:void 0)||h}function M(e,t,n){return e=void 0!==t?Math.max(e,t):e,e=void 0!==n?Math.min(e,n):e}var k=[];function F(e,t){var n={name:e,ranges:{}};return t.split(", ").forEach((e,t)=>n.ranges[["length","height","weight","speed","age","pollenFluid","liftingCapacity","iq","activity"][t]]=e.split("-").map(e=>parseFloat(e))),k.push(n),n}function j(e){for(var t of k)if(t.name==e)return t}F("Worker","150-180, 75-90, 5000-7000, 15-30, 20-22, 3-11, 4-12, 40-80, 40-50"),F("Seedling","85-100, 55-60, 4000-6000, 8-16, 0-20, 0-0, 1-3, 10-30, 20-30"),F("Soldier","300-350, 150-175, 170000-205000, 12-24, 20-360, 0-0, 200-300, 60-100, 15-25"),F("Drone","300-350, 150-175, 172000-208000, 15-30, 20-360, 67-242, 210-330, 60-90, 15-25"),F("Queen","250-270, 320-350, 500000-700000, 0-0, 360-600, 0-0, 500-700, 80-140, 60-60");var E="15:Common\n7:Shadow\n9:Igneous\n13:Cannibal\n10:Aquatic\n10:Amphibious\n11:Carrion\n12:Diseased\n11:Camouflaged\n5:Draconic\n0.33:Saradomin\n0.33:Guthix\n0.33:Zamorak".split("\n").map(function(e){return e.trim().split(":")}),L="150:Worker\n45:Soldier\n30:Drone".split("\n").map(function(e){return e.trim().split(":")});function C(t){t=function(e){var t={};t.job=(e.isMutated?"Mutated ":"")+e.gender+" "+("Seedling"==e.job.name?"Seedling\n("+e.jobAffinity.name+("Worker"==e.jobAffinity.name?", "+e.workerType:"")+")":e.job.name+("Worker"==e.job.name?", "+e.workerType:"")),t.traits=e.traits.filter(e=>"None"!=e.name).map(e=>"• "+e.name).join("\n")||"None",t.handicap=e.handicap.name,t.visualTraits=e.visualTraits.filter(e=>"None"!=e.name).map(e=>"• "+e.name).join("\n")||"None",["gender","pollenFluid"].forEach(n=>t[n]=e[n]),["age","length","height","weight","speed","energy","liftingCapacity","iq","activity"].forEach(function(n){t[n]=parseInt(e[n])}),t.activity=t.activity+" min/hr, "+t.energy+" hrs/day",t.attractiveness=x.filter(t=>e.attractiveness>=parseInt(t[0])).map(e=>e[1])[0],t.health=w.filter(t=>e.health<t[0]).map(e=>"• "+e[1]).join("\n")||"• Healthy",t.fertility=e.fertility.toFixed(0)+(e.pregnant?"% (Pregnant)":"%"),t.age=t.age<30?t.age+" months":(t.age/12).toFixed(0)+" years",t.weight=(e.weight/1e3).toFixed(3);var n=document.querySelector(".val-metric").checked;t.height=n?t.height+" cm":a(t.height),t.length=n?t.length+" cm":a(t.length),t.weight=n?t.weight+" kg":(2.20462*t.weight).toFixed(3)+" lbs",t.dims=t.height+" x "+t.length+", "+t.weight,t.speed=n?t.speed+" km/h":parseInt(.621371*t.speed)+" mph",t.pollenFluid=e.fertileMale?t.pollenFluid.toFixed(1)+" mL":"",t.liftingCapacity=n?t.liftingCapacity+" kg":(2.20462*t.weight).toFixed(3)+" lbs","Queen"==e.job.name&&(t.weight="Unknown");return t}(t);var n=e(void 0,"div","card");return q.forEach(function(i){var a=i.split(":"),r=a[1].split("@");a.length<3&&a.push("$");var o=e(n,"div","prop"+(r.length>1?" num":"")),s=e(o,"span","prop-name"),l=e(o,"span","prop-value");s.innerText=r[0]+": ",l.innerText=a[2].replace("$",void 0===t[a[0].trim()]?"None":t[a[0].trim()])}),n.addEventListener("click",function(e){var t=window.getSelection(),n=document.createRange();n.selectNodeContents(this),e.shiftKey||t.removeAllRanges(),t.addRange(n)}),n}var q="age:Age\n\tjob:Type\n\ttraits:Traits\n\tattractiveness:Attractiveness@\n\tfertility:Fertility@\n\tpollenFluid:Pollen Fluid Production@\n\thandicap:Handicap\n\tvisualTraits:Visual Traits\n\tdims:Dims\n\tspeed:Top Speed@\n\tliftingCapacity:Lifting Capacity@\n\tactivity:Activity@\n\tiq:IQ@\n\thealth:Health@".split("\n");var D,A,T="age:Age\n\tjob:Type\n\ttraits:Traits\n\tattractiveness:Attractiveness@\n\tfertility:Fertility@\n\tpollenFluid:Pollen Fluid Production@\n\thandicap:Handicap\n\tvisualTraits:Visual Traits\n\theight:Height@\n\tlength:Length@\n\tweight:Weight@\n\tspeed:Top Speed@\n\tliftingCapacity:Lifting Capacity@\n\tactivity:Activity@:$ min/hr\n\tenergy:Energy@:$ hrs/day\n\tiq:IQ@\n\thealth:Health@".split("\n"),G=e(document.querySelector(".datagrid"),"tr","");function P(t){t=function(e){var t={};t.job=(e.isMutated?"Mutated ":"")+e.gender+" "+("Seedling"==e.job.name?"Seedling\n("+e.jobAffinity.name+("Worker"==e.jobAffinity.name?", "+e.workerType:"")+")":e.job.name+("Worker"==e.job.name?", "+e.workerType:"")),t.traits=e.traits.filter(e=>"None"!=e.name).map(e=>"• "+e.name).join("\n")||"None",t.handicap=e.handicap.name,t.visualTraits=e.visualTraits.filter(e=>"None"!=e.name).map(e=>"• "+e.name).join("\n")||"None",["gender","pollenFluid"].forEach(n=>t[n]=e[n]),["age","length","height","weight","speed","energy","liftingCapacity","iq","activity"].forEach(function(n){t[n]=parseInt(e[n])}),t.attractiveness=x.filter(t=>e.attractiveness>=parseInt(t[0])).map(e=>e[1])[0],t.health=w.filter(t=>e.health<t[0]).map(e=>"• "+e[1]).join("\n")||"• Healthy",t.fertility=e.fertility.toFixed(0)+(e.pregnant?"% (Pregnant)":"%"),t.age=t.age<30?t.age+" months":(t.age/12).toFixed(0)+" years",t.weight=(e.weight/1e3).toFixed(3);var n=document.querySelector(".val-metric").checked;return t.height=n?t.height+" cm":a(t.height),t.length=n?t.length+" cm":a(t.length),t.weight=n?t.weight+" kg":(2.20462*t.weight).toFixed(3)+" lbs",t.speed=n?t.speed+" km/h":parseInt(.621371*t.speed)+" mph",t.pollenFluid=e.fertileMale?t.pollenFluid.toFixed(1)+" mL":"",t.liftingCapacity=n?t.liftingCapacity+" kg":(2.20462*t.weight).toFixed(3)+" lbs","Queen"==e.job.name&&(t.weight="Unknown"),t}(t);var n=e(document.querySelector(".datagrid"),"tr","");T.forEach(function(i){var a=i.split(":"),r=a[1].split("@");a.length<3&&a.push("$");var o=a[2].replace("$",void 0===t[a[0].trim()]?"None":t[a[0].trim()]);e(n,"td",r.length>1?"num":"").innerText=o})}function z(){this.canvas=document.querySelector(".scene"),this.canvasCenter={x:this.canvas.width/2,y:this.canvas.height/2},this.pos={x:this.canvasCenter.x,y:this.canvasCenter.y},this.context=this.canvas.getContext("2d"),this.zoomRaw=1,this.zoom=1,this.settings={},this.updatePos()}function H(e,t){D&&(D.remove(),D=!1),e&&((D=e).classList.add("floating"),D.style.transform=`translate(${t.x}px, ${t.y}px)`,document.body.append(D))}function I(e,t,n){e!=A?(A&&(A.isHovered=!1),A=e,e?(e.isHovered=!0,H(C(e),n)):H(void 0,n),R()):D&&(D.style.transform=`translate(${n.x}px, ${n.y}px)`)}function R(){l.context.clearRect(0,0,l.canvas.width,l.canvas.height),function(e){N(l,e.center.x,e.center.y,e.size,0,1,"f","#F8F8F8"),N(l,e.center.x,e.center.y,e.size,0,1,5,"#F0F0F0"),N(l,e.entrance.x,e.entrance.y,20,0,1,3,"#000"),function(e){document.querySelector(".scene").getContext("2d");e.forEach(function(e){var t={Male:{Default:"#000",Seedling:"#484",Queen:"#808",Drone:"#88F",Soldier:"#FF3000"},Female:{Default:"#444",Seedling:"#6A6",Queen:"#808",Drone:"#88F",Soldier:"#FF3000"},Herm:{Default:"#222",Seedling:"#505",Queen:"#505",Drone:"#B0B0FF",Soldier:"#FF6347"}},n=-1!=["Male","Female","Herm"].indexOf(e.gender)?e.gender:"Male";N(l,e.pos.x,e.pos.y,.1*e.height,0,1,"f",t[n][e.job.name]||t[n].Default||t.Male.Default,e.isHovered?.75:1),e.isHovered&&N(l,e.pos.x,e.pos.y,.1*e.height,0,1,3,"#000",.2),e.isMutated&&N(l,e.pos.x,e.pos.y,.1*e.height,0,1,3,"#840")}),l.settings.health&&e.forEach(function(e){var t=2/l.zoom,n=e.pos.y-.1*e.height-8/l.zoom+t/2,i=20/l.zoom,a=i*e.health/100,r=e.pos.x-i/2;e.pos.x;O(l,r,n,i,t,"f","#888"),O(l,r,n,a,t,"f","#800"),O(l,r,n,a,t,"f","#0F0",Math.min(e.health/100*.8,1)),O(l,r+i,n,1/l.zoom,t,"f","#222")})}(e.jadinkos)}(c)}function B(e,t,n="#000",i=1){e.context.globalAlpha=i,"f"==t?(e.context.fillStyle=n,e.context.fill()):(e.context.lineWidth=t,e.context.strokeStyle=n,e.context.stroke()),e.context.globalAlpha=1}function N(e,t,n,i,a,r,o,s="#000",l=1,c=!1){t=(t+e.drawOff1.x)*e.zoom+e.drawOff2.x,n=(n+e.drawOff1.y)*e.zoom+e.drawOff2.y,i*=c?1:e.zoom,e.context.beginPath(),e.context.arc(t,n,i,2*Math.PI*a,2*Math.PI*r),B(e,o,s,l)}function O(e,t,n,i,a,r,o="#000",s=1,l=!1){t=(t+e.drawOff1.x)*e.zoom+e.drawOff2.x,n=(n+e.drawOff1.y)*e.zoom+e.drawOff2.y,i*=l?1:e.zoom,a*=l?1:e.zoom,e.context.beginPath(),e.context.rect(t,n,i,a),B(e,r,o,s)}function Q(){this.jadinkos=[],this.center={x:400,y:400},this.size=400,this.rooms={},this.rooms.nursery={x:170,y:600,size:100},this.rooms.queensChamber={x:400,y:650,size:200};this.entrance={x:400*(Math.random()-.5)+this.center.x,y:80}}function W(e){var i=this,a=v.slice().map(e=>e.slice());i.baseType=e.type,i.job=j(e.type)||k[1],i.jobAffinity="Seedling"==i.job.name?j(n(L.concat([[.045,"Queen"]]))):i.job,i.workerType="Random"!=e.breed?e.breed:n(E.concat([[.097*parseFloat(1+.01*e.luminous),"Luminous"]])),i.traits=[b(a[0]),h,h],Math.random()*(10-e.multitrait/100)<=1&&(a[1]=m(a[1],i.traits[0],f),a[2]=m(a[2],i.traits[0],f),i.traits[1]=b(a[1]),Math.random()*(10-e.multitrait/100)<=1&&(a[2]=m(a[2],i.traits[1],f),i.traits[2]=b(a[2])));var o=m(g.slice(),i.traits,f);for(i.handicap=Math.random()*(125-e.multitrait/100)<=1?b(o):h,i.age=t(...i.job.ranges.age),i.length=t(...i.job.ranges.length),i.height=t(...i.job.ranges.height),i.weight=t(...i.job.ranges.weight),i.weight*="Seedling"==i.job.name&&{Soldier:3,Drone:3,Queen:6}[i.jobAffinity.name]||1,i.speed=t(...i.job.ranges.speed),function(e,t){if(Math.random()<=.001||"Herm"==t)e.gender="Herm";else switch(e.jobAffinity.name){case"Queen":e.gender="Female";break;case"Drone":case"Soldier":e.gender="Male";break;default:e.gender="Random"!=t?t:Math.random()<=.5?"Male":"Female"}}(i,e.gender),i.canBePregnant="Male"!=i.gender&&"Seedling"!=i.job.name&&"Soldier"!=i.job.name,i.fertility="Seedling"!=i.job.name&&"Soldier"!=i.job.name?"Queen"==i.job.name?Math.max(r(200,100).toFixed(0),50):r(200,100).toFixed(0):0,i.attractiveness=t(0,2001),i.liftingCapacity=t(...i.job.ranges.liftingCapacity),i.iq=t(...i.jobAffinity.ranges.iq),i.energy=r(25,16).toFixed(0),i.activity=t(...i.job.ranges.activity),i.fertileMale="Female"!=i.gender&&"Seedling"!=i.job.name&&"Soldier"!=i.job.name,i.health=Math.max(r(200,100).toFixed(0),1),i.health*=i.attractiveness/1e3,i.isMutated=100*Math.random()<e.mutation&&!i.traits.find(e=>"Immune"==e.name);i.traits.find(e=>"Immune"==e.name&&"Diseased"==i.workerType);)i.workerType=n(E.concat([[.097*parseFloat(1+.01*e.luminous),"Luminous"]]));i.attractiveness*=("Diseased"==i.workerType?.5:1)*(i.isMutated?.2:1),"Diseased"==i.workerType&&(i.health=Math.min(i.health,50)),i.pollenFluid=i.fertileMale?t(...i.job.ranges.pollenFluid):0,i.pregnant=i.canBePregnant&&("Queen"==i.job.name||Math.random()<(1+.04*i.attractiveness)*(i.fertility/100)/800),"Queen"==i.job.name&&(i.health*=1.05),i.pregnant&&"Queen"!=i.job.name&&(i.speed*=.8,i.energy*=.9,i.weight*=1.2,i.health*=1.05,i.activity*=.95,i.liftingCapacity*=.9),i.traits.find(e=>"Genius"==e.name)&&(i.iq=Math.max(i.iq,(i.jobAffinity.ranges.iq[0]+i.jobAffinity.ranges.iq[1])/2)),i.traits.find(e=>"Nice but Dim"==e.name)&&(i.iq=Math.min(i.iq,(i.jobAffinity.ranges.iq[0]+i.jobAffinity.ranges.iq[1])/2)),i.traits.concat([i.handicap]).forEach(function(e){"speed=s,weight=w,attractiveness=a,age=m,fertility=f,pollenFluid=p,height=t,length=l,liftingCapacity=c,activity=v,energy=e,iq=i,health=h".split(",").map(e=>e.split("=")).forEach(function(t){i[t[0]]=M(i[t[0]],e[t[1]+"LimitLow"],e[t[1]+"LimitHigh"]),i[t[0]]*=e[t[1]+"Mult"]})});var s=m(p.slice().map(e=>e.slice()),i.traits.concat([i.handicap]),f);i.visualTraits=[h,h,h];for(var l=0;l<3&&(i.visualTraits[l]=S(i,s),s=s.map(e=>m(e,i.visualTraits[l],f)),"None"!=i.visualTraits[l].name);l++);return i.visualTraits.forEach(function(e){"speed=s,weight=w,attractiveness=a,age=m,fertility=f,pollenFluid=p,height=t,length=l,liftingCapacity=c,activity=v,energy=e,iq=i,health=h".split(",").map(e=>e.split("=")).forEach(function(t){i[t[0]]=M(i[t[0]],e[t[1]+"LimitLow"],e[t[1]+"LimitHigh"]),i[t[0]]*=e[t[1]+"Mult"]})}),i.energy=Math.min(i.energy,24),i.activity=Math.min(i.activity,60),i}T.forEach(function(t){var n=t.split(":")[1].split("@");e(G,"th","").innerText=n[0]}),z.prototype.resetPos=function(){this.pos={x:this.canvasCenter.x,y:this.canvasCenter.y},this.zoomRaw=1,this.zoom=1,this.updatePos()},z.prototype.updatePos=function(){this.drawOff1={x:-this.pos.x,y:-this.pos.y},this.drawOff2={x:this.canvasCenter.x,y:this.canvasCenter.y}},l=new z,document.querySelector(".scene").addEventListener("wheel",function(e){l.zoomRaw=Math.max(l.zoomRaw+-e.deltaY/1e3,.3),l.zoom=Math.pow(l.zoomRaw,2),e.preventDefault(),R()}),document.querySelector(".scene").addEventListener("mousedown",function(e){if(0==e.button){var t={x:e.pageX,y:e.pageY},n={x:l.pos.x,y:l.pos.y};function i(e){var i=e.pageX-t.x,a=e.pageY-t.y;l.pos.x=n.x-i/l.zoom/(l.canvas.clientWidth/l.canvas.width),l.pos.y=n.y-a/l.zoom/(l.canvas.clientHeight/l.canvas.height),l.updatePos(),R()}document.addEventListener("mousemove",i),document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",i)})}1==e.button&&(e.preventDefault(),l.resetPos(),R())}),document.querySelector(".val-healthbar").addEventListener("change",function(){l.settings.health=this.checked,R()}),l.settings.health=document.querySelector(".val-healthbar").checked,window.addEventListener("click",function(){if(D){var e=window.getSelection(),t=document.createRange();t.selectNodeContents(D),e.removeAllRanges(),e.addRange(t)}}),window.addEventListener("mousemove",function(t){!function(t){var n=t.target.classList.contains("scene"),i={x:t.pageX,y:t.pageY},a=l.canvas.getBoundingClientRect(),r={};r.x=(i.x-(a.left+window.scrollX))/a.width*l.canvas.width,r.y=(i.y-(a.top+window.scrollY))/a.height*l.canvas.height,r.x=(r.x-l.drawOff2.x)/l.zoom-l.drawOff1.x,r.y=(r.y-l.drawOff2.y)/l.zoom-l.drawOff1.y,r.isInside=n,function(t,n){if(t.isInside){for(var i,a=c.jadinkos.length-1;a>=0;a--){var r=c.jadinkos[a],s=o(t,r.pos),l=.1*r.height;if(s<0+l){i=r;break}}if(!i)for(var a=c.jadinkos.length-1;a>=0;a--){var r=c.jadinkos[a],s=o(t,r.pos),l=.1*r.height;if(s<4+l){i=r;break}}I(i,0,n),i||(o(t,c.entrance)<20?H((d=[["Name","Entrance"]],h=e(void 0,"div","card"),d.forEach(function(t){var n=e(h,"div","prop"),i=e(n,"span","prop-name"),a=e(n,"span","prop-value");i.innerText=t[0]+": ",a.innerText=t[1]}),h.addEventListener("click",function(e){var t=window.getSelection(),n=document.createRange();n.selectNodeContents(this),e.shiftKey||t.removeAllRanges(),t.addRange(n)}),h),n):H(void 0))}else I(void 0,0,n);var d,h}(r,i)}(t)}),Q.prototype.isPosDangerousForMutated=function(e){if(o(e,this.rooms.nursery)<this.rooms.nursery.size||o(e,this.rooms.queensChamber)<this.rooms.queensChamber.size)return!0;for(jadinko of this.jadinkos)if("Soldier"==jadinko.job.name&&!jadinko.isMutated&&o(e,jadinko.pos)<80)return!0;return!1},Q.prototype.hideMutated=function(){for(var e of this.jadinkos)if(e.isMutated&&"Queen"!=e.job.name)for(var t=0;t<50&&this.isPosDangerousForMutated(e.pos);t++)e.pos=s({x:400,y:400},0,1200,1)},Q.prototype.addJadinko=function(e){this.jadinkos.push(e),e.hive=this;var t=s({x:400,y:400},0,400,.5);if(e.pos={x:t.x,y:t.y},"Seedling"==e.job.name){var n=Math.random()<.6?this.rooms.nursery:this.rooms.queensChamber;t=s({x:n.x,y:n.y},0,.8*n.size,8);e.pos={x:t.x,y:t.y}}if("Worker"==e.job.name&&Math.random()<.7){t=s({x:400,y:400},0,800,.3);e.pos={x:t.x,y:t.y}}"Worker"==e.job.name&&(Math.random()<.7&&(e.pos=s(this.rooms.queensChamber,0,100,.5)),Math.random()<.7&&(e.pos=s({x:400,y:400},0,800,.3))),"Soldier"==e.job.name&&Math.random()<.1&&(e.pos=s(this.entrance,0,80,.5)),"Drone"==e.job.name&&(Math.random()<.8&&(e.pos=s(this.rooms.nursery,0,.5*this.rooms.nursery.size,.5)),Math.random()<.75&&(e.pos=s(this.rooms.queensChamber,0,.5*this.rooms.queensChamber.size,.5))),"Queen"==e.job.name&&(e.pos=s({x:400,y:755},0,10,1))},document.querySelector(".confirm").addEventListener("click",function(){var e={};function t(t,n,i=""){e[t]=document.querySelector(n).value||i}if(t("count",".val-count"),t("type",".val-type"),t("gender",".val-gender"),t("breed",".val-breed"),t("luminous",".val-luminous"),t("multitrait",".val-multitrait"),t("mutation",".val-mutation"),document.querySelectorAll(".datagrid tr").forEach(function(e,t){t>0&&e.remove()}),document.querySelectorAll(".cards-container .card").forEach(function(e,t){e.remove()}),c=new Q,"Hive"!=e.type)for(var i=0;i<e.count;i++)c.addJadinko(new W(e));else for(i=0;i<e.count;i++)e.type=0==i?"Queen":n(L.concat([[225,"Seedling"]])),c.addJadinko(new W(e));c.hideMutated(),c.jadinkos.forEach(function(e){P(e),function(e){var t=document.querySelector(".cards-container");card=C(e),t.append(card)}(e)}),l.resetPos(),R()})});
